-- MobileFancyVanishCinematic.lua
-- LocalScript داخل StarterPlayerScripts

local lib = {
    ['notification'] = loadstring(game:HttpGetAsync("https://pastefy.app/nXmxy6M0/raw"))(),
}

lib.notification:message{
    Title = "اشعار من السكربت",
    Description = "Saif X Bilal",
    Icon = 126874248908690
}
wait(2)

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local Humanoid, HumanoidRootPart
local Active = false
local GUI_Created = false
local IgnoredPlayers = {} -- لتخزين اللاعبين المتجاهلين

-- ==================== تجهيز الأداة / الحيوان ====================
local toolsToEquip = {"Butterfly","Raccoon"} -- ضع هنا أسماء الحيوانات أو الأدوات
local function equipTools()
    local character = Player.Character
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    for _, toolName in pairs(toolsToEquip) do
        local tool = Player.Backpack:FindFirstChild(toolName)
        if tool then
            humanoid:EquipTool(tool)
            print("تم تجهيز "..toolName)
        else
            Player.Backpack.ChildAdded:Connect(function(child)
                if child.Name == toolName then
                    humanoid:EquipTool(child)
                    print("تم تجهيز "..toolName.." بعد الانتظار")
                end
            end)
        end
    end
end

-- ==================== GUI ====================
local function createGUI()
    if GUI_Created then return end
    GUI_Created = true

    local PlayerGui = Player:WaitForChild("PlayerGui")
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "AutoFollowGui"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.Parent = PlayerGui

    -- زر تشغيل/إيقاف
    local Button = Instance.new("TextButton")
    Button.Name = "ToggleButton"
    Button.Size = UDim2.new(0, 120, 0, 40)
    Button.Position = UDim2.new(0.5, -60, 0.05, 0)
    Button.BackgroundColor3 = Active and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.Font = Enum.Font.SourceSansBold
    Button.TextScaled = true
    Button.Text = Active and "تشغيل" or "إقاف"
    Button.Parent = ScreenGui

    Button.MouseButton1Click:Connect(function()
        Active = not Active
        Button.Text = Active and "تشغيل" or "إقاف"
        Button.BackgroundColor3 = Active and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
    end)

    -- Drag للزر
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        Button.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end

    Button.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Button.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    Button.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    -- Dropdown لتجاهل اللاعبين
    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Size = UDim2.new(0, 120, 0, 30)
    dropdownButton.Position = UDim2.new(0.85, -120, 0.05, 0)
    dropdownButton.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
    dropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropdownButton.Text = "تجاهل لاعب"
    dropdownButton.Parent = ScreenGui

    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, 120, 0, 0)
    dropdownFrame.Position = UDim2.new(0.85, -120, 0.12, 0)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    dropdownFrame.Visible = false
    dropdownFrame.Parent = ScreenGui

    local function updateDropdown()
        for _, child in pairs(dropdownFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
        local yPos = 0
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= Player then
                local btn = Instance.new("TextButton")
                btn.Size = UDim2.new(1,0,0,30)
                btn.Position = UDim2.new(0,0,0,yPos)
                btn.BackgroundColor3 = Color3.fromRGB(100,100,100)
                btn.TextColor3 = Color3.fromRGB(255,255,255)
                btn.Text = plr.Name .. (IgnoredPlayers[plr] and " ✅" or "")
                btn.Parent = dropdownFrame

                btn.MouseButton1Click:Connect(function()
                    if IgnoredPlayers[plr] then
                        IgnoredPlayers[plr] = nil
                    else
                        IgnoredPlayers[plr] = true
                    end
                    updateDropdown()
                end)

                yPos = yPos + 30
            end
        end
        dropdownFrame.Size = UDim2.new(0, 120, 0, yPos)
    end

    dropdownButton.MouseButton1Click:Connect(function()
        dropdownFrame.Visible = not dropdownFrame.Visible
        if dropdownFrame.Visible then
            updateDropdown()
        end
    end)
end

-- ==================== Character Setup ====================
local function setupCharacter(char)
    Humanoid = char:WaitForChild("Humanoid")
    HumanoidRootPart = char:WaitForChild("HumanoidRootPart")
    Humanoid.WalkSpeed = 20
    equipTools()
end

Player.CharacterAdded:Connect(setupCharacter)
if Player.Character then
    setupCharacter(Player.Character)
end

createGUI()

-- ==================== فلتر الأعداء ====================
local function isEnemy(plr)
    if IgnoredPlayers[plr] then return false end
    if not plr.Character then return false end

    local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
    local root = plr.Character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not root then return false end
    if humanoid.Health <= 0 or humanoid.PlatformStand then return false end

    local myTeam = Player.Character and Player.Character:FindFirstChild("team")
    local otherTeam = plr.Character:FindFirstChild("team")
    if myTeam and otherTeam and myTeam.Value == otherTeam.Value then
        return false
    end

    return true
end

-- ==================== AutoFollow ====================
local function getNearestPlayer()
    if not HumanoidRootPart then return nil end
    local nearest, shortestDistance = nil, math.huge
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= Player and isEnemy(plr) then
            local targetRoot = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
            if targetRoot then
                local dist = (targetRoot.Position - HumanoidRootPart.Position).Magnitude
                if dist < shortestDistance then
                    shortestDistance = dist
                    nearest = plr
                end
            end
        end
    end
    return nearest
end

RunService.Heartbeat:Connect(function()
    if Active and Humanoid and HumanoidRootPart then
        local targetPlayer = getNearestPlayer()
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local targetPos = targetPlayer.Character.HumanoidRootPart.Position
            Humanoid:MoveTo(Vector3.new(targetPos.X, HumanoidRootPart.Position.Y, targetPos.Z))
            if targetPos.Y - HumanoidRootPart.Position.Y > 2 then
                Humanoid.Jump = true
            end
        end
    end
end)
